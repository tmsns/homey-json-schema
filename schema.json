{
    "$schema": "http://json-schema.org/draft-04/schema#",
    "title": "App",
    "type": "object",
    "definitions": {
        "argsArray": {
            "type": "array",
            "description": "List of arguments to be used in the card.",
            "items": {
                "type": "object",
                "description": "Argument for the card that will allow the user to input information.",
                "additionalProperties": false,
                "properties": {
                    "name": {
                        "type": "string",
                        "description": "The name of the argument.",
                        "default": "what_to_say"
                    },
                    "type": {
                        "type": "string",
                        "description": "Type of the argument to render a control.",
                        "default": "text",
                        "enum": [
                            "autocomplete",
                            "dropdown",
                            "text",
                            "number",
                            "device",
                            "color"
                        ]
                    },
                    "min": {
                        "type": "number",
                        "description": "Minimum allowed value for number-type arguments."
                    },
                    "max": {
                        "type": "number",
                        "description": "Maximum allowed value for number-type arguments."
                    },
                    "style": {
                        "type": "object",
                        "description": "Additional styling options for the control.",
                        "properties": {
                            "width": {
                                "type": "string"
                            }
                        }
                    },
                    "filter": {
                        "type": "string",
                        "default": "driver_uri=homey:app:com.coffee.machine",
                        "description": "Querystring-like filter for device-type arguments, eg. driver_uri=homey:app:com.coffee.machine&driver_id=coffeemachine"
                    },
                    "placeholder": {
                        "description": "Text to be shown without any data in the input.",
                        "$ref": "#/definitions/translatableObject"
                    },
                    "values": {
                        "type": "array",
                        "description": "List of allowed values in dropdown-type and autocomplete-type arguments",
                        "items": {
                            "type": "object",
                            "additionalProperties": false,
                            "properties": {
                                "id": {
                                    "type": "string",
                                    "description": "Internal ID of the value."
                                },
                                "label": {
                                    "description": "User viewable label of the value.",
                                    "$ref": "#/definitions/translatableObject"
                                }
                            }
                        }
                    }
                }
            }
        },
        "imageObject": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "large": {
                    "type": "string",
                    "description": "Location of a large image. eg. ./somedir/some-large-image.jpg"
                },
                "small": {
                    "type": "string",
                    "description": "Location of a small image. eg. ./somedir/some-small-image.jpg"
                }
            }  
        },
        "translatableObject": {
            "type": "object",
            "additionalProperties": false,
            "required": ["en"],
            "properties": {
                "en": {
                    "type": "string",
                    "description": "English translation of the object."                         
                },
                "nl": {
                    "type": "string",
                    "description": "Dutch translation of the object."
                },
                "de": {
                    "type": "string",
                    "description": "German translation of the object."
                },
                "es": {
                    "type": "string",
                    "description": "Spanish translation of the object."
                },
                "fr": {
                    "type": "string",
                    "description": "French translation of the object."
                }
            }
        },
        "setting": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "type": {
                    "type": "string"
                },
                "id": {
                    "type": "string"  
                },
                "label": {
                    "$ref": "#/definitions/translatableObject",
                    "description": "Label of the setting."
                },
                "children": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/setting"
                    }
                }
            } 
        },
        "category": {
            "type": "string",
            "description": "The category of the Homey app, eg. video",
            "enum": [
                "appliances",
                "climate",
                "internet",
                "lights",
                "music",
                "tools",
                "security",
                "video"
            ]
        }
    },
    "additionalProperties": false,
    "required": ["id", "name", "version", "compatibility"],
    "properties": {
        "$schema": {
            "type": "string",
            "description": "The schema to be used for validation of this json file."
        },
        "id": { 
            "type": "string",
            "default": "com.athom.hello",
            "description": "Internal ID of the Homey app. The app's ID should be a reverse domain name. For example, if you're creating an app for https://solarpanels.acme.org, your app ID will be org.acme.solarpanels.",
            "pattern": "^[a-z0-9\\-](?=.*?\\.)[a-z0-9\\.\\-]{3,}[a-z0-9\\-]$"
        },
        "category": {
            "default": "",
            "anyOf": [
                {
                    "type": "array",
                    "uniqueItems": true,
                    "description": "The categories of the Homey app, eg. video, music. These will be used in the app store.",
                    "items": { 
                        "$ref": "#/definitions/category"            
                    }
                },
                {
                    "$ref": "#/definitions/category"            
                }
            ]
        },
        "version": { 
            "type": "string",
            "default": "0.0.1",
            "description": "Version of the Homey app. The version should be following SemVer rules: http://semver.org/."
        },
        "compatibility": { 
            "type": "string",
            "description": "Compatibility rules of the app with the Homey version.",
            "default": "0.x || 1.x"
        },
        "name": { 
            "$ref": "#/definitions/translatableObject",
            "description": "Name of the Homey app as seen by users. It will be shown in the app store and in the settings > apps section of the Homey."
        },
        "description": { 
            "$ref": "#/definitions/translatableObject",
            "description": "Description of the Homey app."
        },
        "author": { 
            "type": "object",
            "description": "Author of the Homey app.",
            "additionalProperties": false,
            "properties": {
                "name" : {
                    "type": "string",
                    "description": "Name of the author, eg. John Doe"
                },
                "email" : {
                    "type": "string",
                    "description": "Email of the author, eg. john@acme.com"
                },
                "website" : {
                    "type": "string",
                    "description": "Name of the author, eg. http://www.acme.com/"
                }
            }
        },
        "permissions": {
            "type": "array",
            "description": "All requested permissions of the Homey app.",
            "items": {
                "type": "string",
                "enum": [
                    /* no support for descriptions just yet: https://github.com/json-schema/json-schema/wiki/enumNames-(v5-proposal) */
                    "homey:manager:alarm", /* View, create and cancel alarms */
                    "homey:manager:devices", /* View, create and delete your devices */
                    "homey:manager:geolocation", /* "View your Homey's location */
                    "homey:manager:insights", /* "Read your insights */
                    "homey:manager:ledring", /* "Control Homey's LED ring */
                    "homey:manager:media", /* "Play and pause music  */
                    "homey:manager:speech-input", /* "React to your speech, or ask a question  */
                    "homey:manager:speech-output", /* "Let Homey say something  */
                    "homey:wireless:433", /* "Send and receive on the 433.92 MHz frequency  */
                    "homey:wireless:868", /* "Send and receive on the 868 MHz frequency  */
                    "homey:wireless:nfc" /* "Read and write NFC tags */
                ]
            }
        },
        "speech": {
            "type": "array",
            "description": "List of speech events that the Homey app should support.",
            "default": {},
            "items": {
                "type": "object",
                "additionalProperties": false,
                "required": ["id", "importance", "triggers"],
                "properties": {
                    "id": {
                        "description": "Internal ID of the speech event, eg. weather",
                        "type": "string"
                    },
                    "importance": {
                        "description": "Importance of the speech event. The importance tells Homey how likely it is that those specific words are meant for your app, on a scale of 0 to 1. Do not abuse this, as your app will incorrectly trigger often, which leads to it being deleted by the user, and maybe deleted by Athom from the app store.",
                        "type": "number",
                        "minimum": 0,
                        "maximum": 1
                    },
                    "triggers": {
                        "description": "List of triggers for the speech event.",
                        "type": "object",
                        "additionalProperties": false,
                        "required": ["en"],
                        "properties": {
                            "en" : {
                                "type": "array",
                                "description": "List of English keywords to trigger on, eg. weather.",
                                "items": {
                                    "type": "string"
                                }
                            },
                            "nl" : {
                                "type": "array",
                                "description": "List of Dutch keywords to trigger on, eg. weer.",
                                "items": {
                                    "type": "string"
                                }
                            },
                            "de" : {
                                "type": "array",
                                "description": "List of German keywords to trigger on, eg. wetter.",
                                "items": {
                                    "type": "string"
                                }
                            },
                            "es" : {
                                "type": "array",
                                "description": "List of Spanish keywords to trigger on, eg. clima.",
                                "items": {
                                    "type": "string"
                                }
                            },
                            "fr" : {
                                "type": "array",
                                "description": "List of French keywords to trigger on, eg. météo.",
                                "items": {
                                    "type": "string"
                                }
                            }
                        }      
                    }
                }
            }
        },
        "drivers": {
            "type": "array",
            "items": {
                "type": "object",
                "additionalProperties": false,
                "required": ["id", "name", "class", "capabilities"],
                "properties": {
                    "id": {
                        "type": "string",
                        "description": "Internal ID of the driver, eg. my-driver"
                    },
                    "name": {
                        "$ref": "#/definitions/translatableObject",
                        "description": "User viewable name of the driver."
                    },
                    "images": {
                        "$ref": "#/definitions/imageObject"
                    },
                    "class": {
                        "type": "string"
                    },
                    "capabilities": {
                        "type": "array",
                        "items": {
                            "type": "string"
                        }
                    },
                    "pair": {
                        "type": "array",
                        "items": {
                            "type": "object",
                            "additionalProperties": false,
                            "required": ["id"],
                            "properties": {
                                "id" : {
                                    "type": "string"
                                },
                                "template" : {
                                    "type": "string"
                                },
                                "navigation": {
                                    "type": "object",
                                    "additionalProperties": false,
                                    "properties": {
                                        "next": {
                                            "type": "string"
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "settings": {
                        "type": "array",
                        "items": {
                            "$ref": "#/definitions/setting"
                        }
                    }
                }                
            }
        },
        "images": {
            "$ref": "#/definitions/imageObject"
        },
        "flow": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "triggers" : {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "additionalProperties": false,
                        "required": ["id", "title"],
                        "properties": {
                            "id" : {
                                "type": "string",
                                "description": "Internal ID of the trigger card."
                            },
                            "title": {
                                "$ref": "#/definitions/translatableObject",
                                "description": "User viewable title of the trigger card."
                            },
                            "fluidArgs" : {
                                "type": "boolean"
                            },
                            "args": {
                                "$ref": "#/definitions/argsArray"
                            },
                            "tokens": {
                                "type": "array",
                                "items": {
                                    "type": "object",
                                    "additionalProperties": false,
                                    "properties": {
                                        "name": {
                                            "type": "string",
                                            "description": "Internal name of the token."
                                        },
                                        "title": {
                                            "$ref": "#/definitions/translatableObject",
                                            "description": "User viewable title of the token."
                                        },
                                        "example": {
                                            "$ref": "#/definitions/translatableObject",
                                            "description": "Example value of the token."
                                        }
                                    }
                                }
                            }
                        }
                    }
                },
                "conditions" : {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "additionalProperties": false,
                        "required": ["id", "title"],
                        "properties": {
                            "id" : {
                                "type": "string",
                                "description": "Internal ID of the condition card."
                            },
                            "title": {
                                "$ref": "#/definitions/translatableObject",
                                "description": "User viewable title of the condition card."
                            },
                            "args": {
                                "$ref": "#/definitions/argsArray"
                            }
                        }
                    }
                },
                "actions": {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "additionalProperties": false,
                        "required": ["id", "title"],
                        "properties": {
                            "id" : {
                                "type": "string",
                                "description": "Internal ID of the action card."
                            },
                            "title": {
                                "$ref": "#/definitions/translatableObject",
                                "description": "User viewable title of the action card."
                            },
                            "fluidArgs" : {
                                "type": "boolean"
                            },
                            "args": {
                                "$ref": "#/definitions/argsArray"
                            }
                        }
                    }
                }
            }            
        },
        "contributors": {
            "type": "object",
            "description": "A list of contributors to the Homey app.",
            "additionalProperties": false,
            "properties": {
                "developers": {
                    "type": "array",
                    "description": "A list of developers that contributed to the Homey app.",
                    "items": {
                        "type": "object",
                        "default": {},
                        "additionalProperties": false,
                        "properties": {
                            "email": {
                                "type": "string",
                                "description": "Email of the developer.",
                                "format": "email"
                            }
                        }
                    }
                },
                "translators": {
                    "type": "array",
                    "description": "A list of translators that contributed to the Homey app.",
                    "items": {
                        "type": "object",
                        "default": {},
                        "additionalProperties": false,
                        "properties": {
                            "email": {
                                "type": "string",
                                "description": "Email of the translator.",
                                "format": "email"
                            },
                            "lang": {
                                "type": "string",
                                "description": "Language of the translation."
                            }
                        }
                    }
                }
            }
        },
        "dependencies": {
            "type": "object",
            "description": "A list of NPM packages the app is depending on, eg. \"node-hue-api\": \"1.1.*\"",
            "patternProperties": {
                ".*": {
                    "type": "string",
                    "default": "1.0.0",
                    "description": "SemVer version of the NPM package."
                }
            }
        }
    }
}
